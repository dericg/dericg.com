mailster=function(a,t,e,n){"use strict";var i=t(n.body).hasClass("mobile"),s=t(n.body).hasClass("index-php"),r=t(".mailster-mb-subscribers"),o=t("#mailster-subscriber-range"),l=t("#subscriber-chart-wrap"),d=t("#subscriber-chart"),c,u,h={responsive:false,legend:false,animationEasing:"easeOutExpo",maintainAspectRatio:false,tooltips:{backgroundColor:"rgba(56,56,56,0.9)",displayColors:false,cornerRadius:2,caretSize:8,callbacks:{label:function(t,e){return a.util.sprintf(a.l10n.dashboard.subscribers,k(t.yLabel))}}},scales:{xAxes:[{ticks:{maxTicksLimit:20},_type:"time",_time:{format:"MM/DD/YYYY HH:mm",round:"day",tooltipFormat:"ll HH:mm"}}],yAxes:[{ticks:{callback:function(a){return v(a,true)}}}]}};if(d.length){u=d[0].getContext("2d")}o.on("change",function(){b()}).trigger("change");!s&&e.postboxes.add_postbox_toggles("newsletter_page_mailster_dashboard");t(n).on("click",".locked",function(){e.location="admin.php?page=mailster_convert"}).on("click",".enable-auto-update",function(){var e=t(this);e.html(a.l10n.dashboard.checking);t.get(this.href,function(){e.remove()});return false}).on("click",".check-for-update",function(){var e=t(this);e.html(a.l10n.dashboard.checking);a.util.ajax("check_for_update",function(n){e.html(a.l10n.dashboard.check_again);if(n.success){e.closest(".postbox")[n.data?"addClass":"removeClass"]("has-update");if(n.data){t(".update-version").html(n.data.version);t(".update-last-check").html(n.data.updated)}}});return false}).one("click",".load-language",function(){var e=t(this);e.html(a.l10n.dashboard.downloading);a.util.ajax("load_language",function(t){if(t.success){e.html(a.l10n.dashboard.reload_page)}});return false});var f=function(e){if(!e){return}var i,s=t(".mailster-mb-"+e),r=s.find(".mailster-mb-select"),o=s.find(".mailster-mb-label"),l=s.find(".mailster-mb-link"),d=l.attr("href");if(!r.length){return}r.on("change",function(){c(t(this).val())}).trigger("change");t(n).on("heartbeat-tick",function(a,t){if(i){c(i,true)}});s.find(".piechart").easyPieChart({animate:1e3,rotate:180,barColor:a.colors.main,trackColor:a.colors.track,lineWidth:9,size:75,lineCap:"butt",onStep:function(a){this.$el.find("span").text(Math.round(a))},onStop:function(a){this.$el.find("span").text(Math.round(a))}});function c(t,n){if(!n){s.addClass("mailster-loading")}a.util.ajax("get_dashboard_data",{type:e,id:t},function(a){var t=a.data.data;l.html(t.name).removeAttr("class").addClass("mailster-mb-link").attr("href",d.replace("%d",t.ID));if(t.status){l.addClass("status-"+t.status)}s.find(".stats-total").html(t.sent_formatted);s.find(".stats-open").data("easyPieChart").update(t.openrate*100);s.find(".stats-clicks").data("easyPieChart").update(t.clickrate*100);s.find(".stats-unsubscribes").data("easyPieChart").update(t.unsubscriberate*100);s.find(".stats-bounces").data("easyPieChart").update(t.bouncerate*100);i=t.ID;s.removeClass("mailster-loading")})}};var m=new f("campaigns");var p=new f("lists");function b(t,e,n,i){r.addClass("mailster-loading");a.util.ajax("get_dashboard_chart",{range:o.val()},function(a){g();r.removeClass("mailster-loading");if(!c){c=new Chart(u,{type:"line",data:a.data.chart,options:h})}})}function g(){c=null;if(d){d.remove()}d=t("<canvas>").prependTo(l);u=d[0].getContext("2d");d.attr({width:l.width(),height:l.height()})}function v(a,t){if(a>=1e6){return(a/1e3).toFixed(1)+"M"}else if(a>=1e3&&!t){return(a/1e3).toFixed(1)+"K"}return!(a%1)?k(a):""}function k(a,t,e,n){a=(a+"").replace(/[^0-9+\-Ee.]/g,"");var i=!isFinite(+a)?0:+a;var s=!isFinite(+t)?0:Math.abs(t);var r=typeof n==="undefined"?",":n;var o=typeof e==="undefined"?".":e;var l="";var d=function(a,t){var e=Math.pow(10,t);return""+(Math.round(a*e)/e).toFixed(t)};l=(s?d(i,s):""+Math.round(i)).split(".");if(l[0].length>3){l[0]=l[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,r)}if((l[1]||"").length<s){l[1]=l[1]||"";l[1]+=new Array(s-l[1].length+1).join("0")}return l.join(o)}return a}(mailster||{},jQuery,window,document);